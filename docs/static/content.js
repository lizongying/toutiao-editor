class r{constructor(){r.editor=null,this.observerEditor()}init(){const t=r.editor;let n=document.querySelector("#textarea");n||(n=document.createElement("textarea"),n.id="textarea",n.placeholder="请输入Markdown",n.style.minHeight="100px",n.style.width="100%",n.style.border="none",n.style.resize="none",n.style.outline="none",n.style.fontFamily="PingFang SC, Arial, Hiragino Sans GB, WenQuanYi Micro Hei, Helvetica Neue, sans-serif",n.style.color="#222",n.style.fontSize="18px",n.style.caretColor="auto",n.style.borderBottom="1px solid rgb(232, 232, 232)",document.querySelector(".publish-editor-title-wrapper").appendChild(n)),n.addEventListener("input",()=>{if(t){for(;t.childElementCount>0;)t.removeChild(t.firstChild);let e=null;n.value.split(`
`).forEach(i=>{if(i.trim()){let d=i.match(/(^#{1,6})\s(.*)/);if(d){e!==null&&e.tagName==="PRE"?this.addCode(i,e):e=this.addTitle(d);return}if(d=i.match(/(^[-_*]{3,})\s*$/),d){e!==null&&e.tagName==="PRE"?this.addCode(i,e):e=this.addLine();return}if(d=i.match(/(^!*)\[([^\]]+)]\(([^)]+)\)/),d){e!==null&&e.tagName==="PRE"?this.addCode(i,e):d[1]==="!"?this.addImg(d):this.addLink(d);return}if(d=i.match(/^>\s(.*)/),d){if(e!==null&&e.tagName==="PRE"){this.addCode(i,e);return}e!==null&&e.tagName==="BLOCKQUOTE"?this.addQ(d[1],e):(e=this.addQuote(),this.addQ(d[1],e));return}if(d=i.match(/^[-+*]\s(.*)/),d){if(e!==null&&e.tagName==="PRE"){this.addCode(i,e);return}e!==null&&e.tagName==="UL"?this.addLi(d[1],e):(e=this.addUl(),this.addLi(d[1],e));return}if(d=i.match(/^\d+\.\s(.*)/),d){if(e!==null&&e.tagName==="PRE"){this.addCode(i,e);return}e!==null&&e.tagName==="OL"?this.addLi(d[1],e):(e=this.addOl(),this.addLi(d[1],e));return}if(d=i.match(/(^`+)/),d){e!==null&&e.tagName==="PRE"?e=null:e=this.addPre();return}e!==null&&e.tagName==="PRE"?this.addCode(i,e):e=this.addP(i)}})}}),r.textarea=n}observerEditor(){const t=document.querySelector(".ProseMirror");t&&(r.editor=t,this.init());let n;new MutationObserver(i=>{for(const d of i)if(d.type==="childList"){const l=document.querySelector(".ProseMirror");l&&l!==r.editor&&(r.editor=l,clearTimeout(n),this.init());return}}).observe(document,{childList:!0,subtree:!0})}addTitle(t){const n=document.createElement(`h${t[1].length}`);return n.innerText=t[2],r.editor.appendChild(n),n}addUl(){const t=document.createElement("ul");return r.editor.appendChild(t),t}addOl(){const t=document.createElement("ol");return r.editor.appendChild(t),t}addLi(t,n){const e=document.createElement("li");e.innerText=t,n.appendChild(e)}addPre(){const t=document.createElement("pre");return r.editor.appendChild(t),t}addCode(t,n){n.innerText+=`${t}
`}addP(t){const n=document.createElement("p");let e="",i=0;return[...t.matchAll(/(\s*[_*~]{1,2})([^_*~]+)([_*~]{1,2})(\s*)/g)].forEach(l=>{if(l[3].length===1){const o=document.createElement(l[3]==="~"?"u":"em");o.innerText=l[2],e+=t.slice(i,l.index+l[1].length-l[3].length)+o.outerHTML+t.slice(l.index+l[0].length-l[4].length,l.index+l[0].length),i+=l.index+l[0].length}if(l[3].length===2){const o=document.createElement(l[3]==="~~"?"s":"strong");o.innerText=l[2],e+=t.slice(i,l.index+l[1].length-l[3].length)+o.outerHTML+t.slice(l.index+l[0].length-l[4].length,l.index+l[0].length),i+=l.index+l[0].length}}),e+=t.slice(i),n.innerHTML=e,r.editor.appendChild(n),n}addLine(){const t=document.createElement("hr");return r.editor.appendChild(t),t}addQuote(){const t=document.createElement("blockquote");return r.editor.appendChild(t),t}addQ(t,n){const e=document.createElement("p");e.innerText=t,n.appendChild(e)}addLink(t){const n=document.createElement("a");n.innerText=t[2],n.href=t[3],r.editor.appendChild(n)}addImg(t){const n=document.createElement("img");n.alt=t[2],n.src=t[3],r.editor.appendChild(n)}}new r;
